@model List<MVC_P.Models.Event>
@{
    var counts = (IDictionary<int,int>) (ViewBag.RegCounts ?? new Dictionary<int,int>());
    bool canManage = User?.Identity?.IsAuthenticated == true && (User.IsInRole("Admin") || User.IsInRole("KulupYoneticisi"));
}
<ul class="list-group">
@foreach (var e in Model)
{
    var regCount = counts.ContainsKey(e.Id) ? counts[e.Id] : 0;
    var remaining = Math.Max(0, e.Kontenjan - regCount);
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
            <strong>@e.Baslik</strong> - @e.BaslangicTarihi.ToString("g")
            <div class="small text-muted">Kayýtlý: @regCount / Kalan: @remaining</div>
        </div>
        <div class="btn-group">
            <a class="btn btn-sm btn-outline-primary" asp-action="Details" asp-route-id="@e.Id">Detay</a>
            @if (canManage)
            {
                <a class="btn btn-sm btn-outline-secondary" asp-action="Edit" asp-route-id="@e.Id">Düzenle</a>
                <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@e.Id">Sil</a>
            }
        </div>
    </li>
}
</ul>
